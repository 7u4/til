# How to get access-logs from openshift router (HAproxy)

You will need to point the router at a syslog server to debug the output. No access logs are output by default.

To view a router log, run the `oc logs` command on the pod. Since the router is running as a plug-in process that manages the underlying implementation, the log is for the plug-in, not the actual HAProxy log.

To view the logs generated by HAProxy, start a syslog server and pass the location to a router pod using the following environment variables.

`ROUTER_SYSLOG_ADDRESS`: The IP address of the syslog server. Port 514 is the default if no port is specified.

`ROUTER_LOG_LEVEL`: Optional. Set to change the HAProxy log level. If not set, the default log level is warning. This can be changed to any log level that HAProxy supports.

`ROUTER_SYSLOG_FORMAT`: Optional. Set to define customized HAProxy log format. This can be changed to any log format string that HAProxy accepts.

## Steps

1. Deploy syslog server where your router is running in default namespace as below:

```yaml
kind: Service
apiVersion: v1
metadata:
  labels:
    app: haproxy-rsyslog
    group: com.stakater.platform
    provider: stakater
    version: "0.0.1"
  name: haproxy-rsyslog
spec:
  selector:
    app: haproxy-rsyslog
  ports:
  - name: logger-tcp
    port: 514
    protocol: TCP
    targetPort: 1514
  - name: logger-udp
    port: 514
    protocol: UDP
    targetPort: 1514
---
apiVersion: apps/v1beta1
kind: Deployment
metadata:
  labels:
    app: haproxy-rsyslog
    group: com.stakater.platform
    provider: stakater
    version: "0.0.1"
  name: haproxy-rsyslog
spec:
  replicas: 1
  template:
    metadata:
      labels:
        app: haproxy-rsyslog
    spec:
      containers:
      - name: haproxy-rsyslog
        image: "stakater/rsyslog:v0.0.1"
        ports:
        - containerPort: 1514
```

2. Update Router Pod's Environment variable

`oc set env dc/router ROUTER_SYSLOG_ADDRESS=<syslog-service-name>.default.svc ROUTER_LOG_LEVEL=debug -n default`

Check the logs of rsyslog pod, it should start showing the logs of your router.

### References

- https://stackoverflow.com/questions/48519103/how-to-get-access-logs-from-openshift-routerhaproxy

- https://docs.openshift.com/container-platform/3.7/admin_guide/router.html#viewing-logs